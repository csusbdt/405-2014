---
layout: assignment
title: File Assignment
---

<div class="csusbdt-video-btn">
  <a class="btn btn-success" role="button" target="_blank" href="http://youtu.be/v9bMJzCI9tA">Video</a>
</div>

<h2>Overview</h2>

<p>
The purpose of this assignment is to learn how to read files into buffers 
and deliver their contents to requesting clients.
</p>

<h2>Assignment folder</h2>

<p>
Create a directory named <code>file</code> 
for the work you do for this assignment. 
At the end of the assignment, 
this folder will contain the following files.
</p>

<ul>
<li>app.html</li>
<li>image.js</li>
<li>image.png</li>
<li>main.js</li>
<li>root.js</li>
</ul>

<h2>Instructions</h2>

<p>
Create a file named <em>app.html</em>. 
Add HTML content to the file.
</p>

<p>
Our strategy will be to read app.html into a buffer 
when he server starts. 
When browsers send a request for <code>/</code>, 
we return the contents of the buffer.
</p>

<p>
Copy main.js from <a href="buf.html">the buffers assignment</a>. 
Use the code I provided in the Web page,
not the code that you submitted for the assignment.
</p>

<p>
Create file root.js with the following contents.
</p>

<pre>
var http = require('http');

var body;

exports.handle = function(req, res) {
  res.writeHead(200, {
    'Content-Type': 'text/html; charset=UTF-8',
    'Content-Length': body.length
  });
  res.end(body);
};

exports.init = function(cb) {
  require('fs').readFile('app.html', function(err, data) {
    if (err) throw err;
    body = data;
    cb();
  });
}
</pre>

<p>
Modify main.js so that it calls the exported init function 
in the root module <em>before</em> the server starts listening to port 5000. 
To accomplish this, you need to run the command 
to listen to port 5000 inside the callback function that you pass into <code>init</code>.
</p>

<p>
Run and test with browser.
</p>

<p>
Add an <code>img</code> element to your web page 
that loads an image named <em>image.png</em> from your server. 
There are many ways to return the image from the server, 
but for this assignment you should create a module 
similar to root.js that does the job. 
Call the module file <em>image.js</em>.
</p>

<p>
Write the code so that the activities started by 
the init function of 
the <code>root</code> and <code>image</code> modules
both complete before the <code>main</code> module
starts to listen for connections.
</p>

<p>
You'll need to set the <code>Content-Type</code> 
appropriately for the image data that you return.
For example, if the image is a png file, 
then the content type
is <code>image/png</code>; if it's a jpg file,
the content type is <code>image/jpeg</code>.
</p>

<p>
Run and test with browser.
</p>

