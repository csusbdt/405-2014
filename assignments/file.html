---
layout: assignment
title: File Assignment
---

<div class="csusbdt-video-btn">
  <a class="btn btn-success" role="button" target="_blank" href="http://youtu.be/v9bMJzCI9tA">Video</a>
</div>

<h2>Overview</h2>

<p>
The purpose of this assignment is to learn how to read files into buffers 
and deliver their contents to requesting clients.
</p>

<h2>Assignment folder</h2>

<p>
Create a directory named <em>file</em> 
for the work you do for this assignment. 
At the end of the assignment, 
this folder will contain the following files.
</p>

<ul>
<li>app.html</li>
<li>image.js</li>
<li>image.png</li>
<li>main.js</li>
<li>root.js</li>
</ul>

<h2>Step 1</h2>

<p>
This assignment builds on the work you did for
<a href="buf.html">the buffers assignment</a>.
For this reason, start by creating a folder named <em>file</em>
and then copy the contents of the <em>buf</em> folder into it.
</p>

<p>
Verify that the code you copied into the <em>buf</em> folder runs.
</p>

<h2>Step 2</h2>

<p>
Create a file named <em>app.html</em>
and add some simple HTML to it.
You will write code that reads the contents
of this file when the server starts
and returns this data to browsers that 
request the resource associated with the root path <code>/</code>.
</p>

<p>
Our strategy will be to read the file <em>app.html</em> 
into a buffer when the server starts,
and return the contents of the buffer 
for each request sent by browsers the root path <code>/</code>.
This procedure is more efficient than
reading the file from the file system for each request;
however, it requires us to restart the server
to test changes to the file.
</p>

<p>
Replace the contents of file <em>root.js</em> 
with the following.
This code uses the <code>readFile</code> method of the
<code>fs</code> module to read the contents of <em>app.html</em>
into an instance of <code>Buffer</code>.
This is done in a function named <code>init</code>.
This function must be called from the main module
when the server starts.
</p>

<pre>
var http = require('http');

var body;

exports.handle = function(req, res) {
  res.writeHead(200, {
    'Content-Type': 'text/html; charset=UTF-8',
    'Content-Length': body.length
  });
  res.end(body);
};

exports.init = function(cb) {
  require('fs').readFile('app.html', function(err, data) {
    if (err) throw err;
    body = data;
    cb();
  });
}
</pre>

<p>
Modify <em>main.js</em> so that it calls the exported init function 
in the root module <em>before</em> the server starts listening to port 5000. 
To accomplish this, you need to run the command 
to listen to port 5000 inside a callback function that you pass into <code>init</code>.
</p>

<p>
Run and test with browser.
</p>

<h2>Step 3</h2>

<p>
This part of the assignment includes substantially more work
than the previous parts and so will require more time to complete.
</p>

<p>
You need to create a test image in png format 
for this part of the assignment.
Call the image <em>image.png</em>. 
</p>

<p>
Add an <code>img</code> element to your web page 
that loads an image named <em>image.png</em> from your server. 
</p>

<p>
There are many ways to return the image from the server, 
but for this assignment you should create a module 
similar to <em>root.js</em> that does the job.
Call the module file <em>image.js</em>.
In addition to creating the image module,
you will need to modify the main module to call the <code>handle</code>
function of the image module when the <code>url</code>
of the request object equals <em>/image.png</em>.
</p>

<p>
When you send your image data to the client,
set the <em>Content-Type</em> to <em>image/png</em>.
</p>

<p>
Similar to the root module, the image module will have an init function
that reads file contents into memory when the server starts.
Add code to the main module so that the 
init functions of the root and image modules run in parrallel.
Also, make sure that you do not start listenning to connection requests
until both init function complete.
You should review the parallel code you developed
for <a href="cb">the callbacks assignment</a>
to help you solve this problem.
By running the init functions in parallel,
your server will be ready to process requests as earlier as possible.
</p>

<p>
Run and test with a browser.
</p>

